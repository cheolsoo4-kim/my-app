<template>
  <div class="typing-game">
    <a-layout>
      <a-layout-header class="game-header">
        <h1>ÌÉÄÏûêÍ≤åÏûÑ</h1>
<div class="stats">
          <a-statistic title="ÌÉÄÏàò" :value="wpm" suffix="ÌÉÄ/Î∂Ñ" />
          <a-statistic title="Ï†ïÌôïÎèÑ" :value="accuracy" suffix="%" />
          <a-statistic title="Ï†êÏàò" :value="score" />
        </div>
</a-layout-header>
      
      <a-layout class="main-layout">
        <!-- Í≤åÏûÑ ÏòÅÏó≠ (ÏôºÏ™Ω) -->
        <a-layout-content class="game-content">
          <!-- Í≤åÏûÑ ÏÑ§Ï†ï Ìå®ÎÑê -->
          <a-card v-if="!gameStarted" class="setup-panel">
            <h2>Í≤åÏûÑ ÏÑ§Ï†ï</h2>
<a-form layout="vertical">
              <a-form-item label="ÌîåÎ†àÏù¥Ïñ¥ Ïù¥Î¶Ñ">
                <a-input v-model:value="playerName" placeholder="Ïù¥Î¶ÑÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî" />
              </a-form-item>
              <a-form-item label="ÎÇúÏù¥ÎèÑ">
                <a-select v-model:value="difficulty">
                  <a-select-option value="easy">Ïâ¨ÏõÄ</a-select-option>
                  <a-select-option value="normal">Î≥¥ÌÜµ</a-select-option>
                  <a-select-option value="hard">Ïñ¥Î†§ÏõÄ</a-select-option>
                </a-select>
              </a-form-item>
              <a-button type="primary" @click="startGame" size="large">
                Í≤åÏûÑ ÏãúÏûë
              </a-button>
            </a-form>
          </a-card>

          <!-- Î©îÏù∏ Í≤åÏûÑ ÏòÅÏó≠ -->
          <div v-if="gameStarted" class="game-area">
            <!-- ÌÉÄÏù¥Î®∏ÏôÄ ÏßÑÌñâÎèÑ -->
            <div class="game-info">
              <a-progress 
                :percent="progress" 
                :status="timeLeft < 10 ? 'exception' : 'active'"
                :strokeColor="timeLeft < 10 ? '#ff4d4f' : '#1890ff'"
              />
              <div class="timer">
                <a-statistic 
                  title="ÎÇ®ÏùÄ ÏãúÍ∞Ñ" 
                  :value="timeLeft" 
                  suffix="Ï¥à"
                  :valueStyle="{ color: timeLeft < 10 ? '#cf1322' : '#3f8600' }"
                />
              </div>
</div>

            <!-- ÌÖçÏä§Ìä∏ ÌëúÏãú ÏòÅÏó≠ -->
            <a-card class="text-display">
              <div class="target-text">
                <span 
                  v-for="(char, index) in currentText" 
                  :key="index"
                  :class="getCharClass(index)"
                >
                  {{ char }}
                </span>
              </div>
</a-card>

            <!-- ÏûÖÎ†• ÏòÅÏó≠ -->
            <div class="input-area">
              <a-input 
                v-model:value="userInput"
                @input="handleInput"
                @keydown="handleKeyDown"
                placeholder="ÏúÑÏùò Î¨∏Ïû•ÏùÑ Ï†ïÌôïÌûà ÏûÖÎ†•ÌïòÏÑ∏Ïöî"
                size="large"
                :disabled="gameEnded"
                ref="gameInput"
              />
            </div>
<!-- Ïù¥Î≤§Ìä∏ ÏïåÎ¶º -->
            <a-alert
              v-if="currentEvent"
              :message="currentEvent.message"
              :type="currentEvent.type"
              :description="currentEvent.description"
              show-icon
              closable
              @close="currentEvent = null"
              class="event-alert"
            />
          </div>
<!-- Í≤åÏûÑ Í≤∞Í≥º -->
          <a-modal 
            v-model:open="showResults"
            title="Í≤åÏûÑ Í≤∞Í≥º"
            :footer="null"
            width="600px"
          >
            <div class="results">
              <a-row :gutter="16">
                <a-col :span="12">
                  <a-statistic title="ÏµúÏ¢Ö Ï†êÏàò" :value="finalScore" />
                </a-col>
                <a-col :span="12">
                  <a-statistic title="ÌèâÍ∑† ÌÉÄÏàò" :value="finalWpm" suffix="ÌÉÄ/Î∂Ñ" />
                </a-col>
              </a-row>
              <a-row :gutter="16" style="margin-top: 16px;">
                <a-col :span="12">
                  <a-statistic title="Ï†ïÌôïÎèÑ" :value="finalAccuracy" suffix="%" />
                </a-col>
                <a-col :span="12">
                  <a-statistic title="ÏôÑÎ£å Î¨∏Ïû•" :value="completedSentences" />
                </a-col>
              </a-row>
              
              <div class="result-actions">
                <a-button type="primary" @click="saveRecord" :loading="saving">
                  Í∏∞Î°ù Ï†ÄÏû•
                </a-button>
                <a-button @click="resetGame">Îã§ÏãúÌïòÍ∏∞</a-button>
              </div>
</div>
          </a-modal>
        </a-layout-content>

        <!-- ÏàúÏúÑÌëú ÏÇ¨Ïù¥ÎìúÎ∞î (Ïò§Î•∏Ï™Ω) -->
        <a-layout-sider 
          width="400" 
          theme="light" 
          class="leaderboard-sidebar"
          :breakpoint="'lg'"
          :collapsedWidth="0"
        >
          <div class="leaderboard-container">
            <div class="leaderboard-header">
              <h3>
                <a-badge :count="leaderboardData.length" showZero>
                  üèÜ Ïã§ÏãúÍ∞Ñ ÏàúÏúÑÌëú
                </a-badge>
              </h3>
<a-button 
                type="text" 
                size="small" 
                @click="loadLeaderboard"
                :loading="loadingLeaderboard"
              >
                <template #icon>
                  <ReloadOutlined />
                </template>
                ÏÉàÎ°úÍ≥†Ïπ®
              </a-button>
            </div>
<!-- ÌïÑÌÑ∞ -->
            <div class="leaderboard-filters">
              <a-select 
                v-model:value="leaderboardFilter" 
                size="small" 
                @change="loadLeaderboard"
                style="width: 100px;"
              >
                <a-select-option value="all">Ï†ÑÏ≤¥</a-select-option>
                <a-select-option value="easy">Ïâ¨ÏõÄ</a-select-option>
                <a-select-option value="normal">Î≥¥ÌÜµ</a-select-option>
                <a-select-option value="hard">Ïñ¥Î†§ÏõÄ</a-select-option>
              </a-select>
              
              <a-select 
                v-model:value="leaderboardPeriod" 
                size="small" 
                @change="loadLeaderboard"
                style="width: 120px; margin-left: 8px;"
              >
                <a-select-option value="all">Ï†ÑÏ≤¥Í∏∞Í∞Ñ</a-select-option>
                <a-select-option value="today">Ïò§Îäò</a-select-option>
                <a-select-option value="week">Ïù¥Î≤àÏ£º</a-select-option>
                <a-select-option value="month">Ïù¥Î≤àÎã¨</a-select-option>
              </a-select>
            </div>
<!-- ÏàúÏúÑÌëú Î¶¨Ïä§Ìä∏ -->
            <div class="leaderboard-list">
              <a-list
                :data-source="leaderboardData"
                :loading="loadingLeaderboard"
                size="small"
              >
                <template #renderItem="{ item, index }">
                  <a-list-item 
                    :class="[
                      'leaderboard-item',
                      { 'current-player': item.playerName === playerName },
                      { 'top-three': index < 3 }
                    ]"
                  >
                    <div class="rank-info">
                      <span class="rank-number">
                        <a-badge 
                          :count="index + 1" 
                          :color="getRankColor(index)"
                          :number-style="{ fontSize: '12px' }"
                        />
                      </span>
                      <div class="player-info">
                        <div class="player-name">
                          {{ item.playerName }}
                          <a-tag v-if="item.difficulty" size="small" :color="getDifficultyColor(item.difficulty)">
                            {{ getDifficultyText(item.difficulty) }}
                          </a-tag>
                        </div>
<div class="player-stats">
                          <span class="score">{{ item.score }}Ï†ê</span>
                          <span class="wpm">{{ item.wpm }}ÌÉÄ/Î∂Ñ</span>
                          <span class="accuracy">{{ item.accuracy }}%</span>
                        </div>
<div class="play-time">
                          {{ item.createdAt }}
                        </div>
</div>
                    </div>
</a-list-item>
                </template>
              </a-list>
            </div>
<!-- Í∞úÏù∏ ÌÜµÍ≥Ñ -->
            <div class="personal-stats" v-if="playerName && personalStats">
              <a-divider>Í∞úÏù∏ ÌÜµÍ≥Ñ</a-divider>
              <a-row :gutter="8">
                <a-col :span="12">
                  <a-statistic 
                    title="ÏµúÍ≥†Ï†êÏàò" 
                    :value="personalStats.bestScore" 
                    :valueStyle="{ fontSize: '14px' }"
                  />
                </a-col>
                <a-col :span="12">
                  <a-statistic 
                    title="Í≤åÏûÑÌöüÏàò" 
                    :value="personalStats.totalGames" 
                    :valueStyle="{ fontSize: '14px' }"
                  />
                </a-col>
              </a-row>
              <a-row :gutter="8" style="margin-top: 8px;">
                <a-col :span="12">
                  <a-statistic 
                    title="ÌèâÍ∑†ÌÉÄÏàò" 
                    :value="personalStats.avgWpm" 
                    suffix="ÌÉÄ/Î∂Ñ"
                    :precision="1"
                    :valueStyle="{ fontSize: '14px' }"
                  />
                </a-col>
                <a-col :span="12">
                  <a-statistic 
                    title="ÌèâÍ∑†Ï†ïÌôïÎèÑ" 
                    :value="personalStats.avgAccuracy" 
                    suffix="%"
                    :precision="1"
                    :valueStyle="{ fontSize: '14px' }"
                  />
                </a-col>
              </a-row>
            </div>
<!-- Ï†ÑÏ≤¥ ÌÜµÍ≥Ñ -->
            <div class="global-stats" v-if="globalStats">
              <a-divider>Ï†ÑÏ≤¥ ÌÜµÍ≥Ñ</a-divider>
              <a-descriptions size="small" :column="1">
                <a-descriptions-item label="Ï¥ù Í≤åÏûÑÏàò">
                  {{ globalStats.totalGames }}
                </a-descriptions-item>
                <a-descriptions-item label="Ï¥ù ÌîåÎ†àÏù¥Ïñ¥Ïàò">
                  {{ globalStats.totalPlayers }}
                </a-descriptions-item>
                <a-descriptions-item label="ÏµúÍ≥†Í∏∞Î°ù">
                  {{ globalStats.highestScore }}Ï†ê
                </a-descriptions-item>
              </a-descriptions>
            </div>
</div>
        </a-layout-sider>
      </a-layout>
    </a-layout>
  </div>
</template>

<script setup>
import { ref, reactive, computed, onMounted, onUnmounted, nextTick, watch } from 'vue'
import { message } from 'ant-design-vue'
import { ReloadOutlined } from '@ant-design/icons-vue'
import { gameTexts, specialEvents } from './gameData'
import { apiService } from '../services/api'

// Í≤åÏûÑ ÏÉÅÌÉú
const gameStarted = ref(false)
const gameEnded = ref(false)
const playerName = ref('')
const difficulty = ref('normal')
const currentTextIndex = ref(0)
const userInput = ref('')
const startTime = ref(null)
const gameTimer = ref(null)
const timeLeft = ref(60)
const score = ref(0)
const completedSentences = ref(0)

// Í≤åÏûÑ ÌÜµÍ≥Ñ
const totalChars = ref(0)
const correctChars = ref(0)
const errors = ref(0)
const wpmHistory = ref([])

// Ïù¥Î≤§Ìä∏ ÏãúÏä§ÌÖú
const currentEvent = ref(null)
const eventTriggered = ref(new Set())

// Í≤∞Í≥º Î™®Îã¨
const showResults = ref(false)
const saving = ref(false)

// ÏàúÏúÑÌëú Í¥ÄÎ†®
const leaderboardData = ref([])
const loadingLeaderboard = ref(false)
const leaderboardFilter = ref('all')
const leaderboardPeriod = ref('all')
const personalStats = ref(null)
const globalStats = ref(null)
const leaderboardTimer = ref(null)

// ÏûÖÎ†• Ï∞∏Ï°∞
const gameInput = ref(null)

// Í≥ÑÏÇ∞Îêú ÏÜçÏÑ±Îì§
const currentText = computed(() => {
  return gameTexts[difficulty.value][currentTextIndex.value] || ''
})

const progress = computed(() => {
  const total = gameTexts[difficulty.value].length
  return (completedSentences.value / total) * 100
})

const wpm = computed(() => {
  if (!startTime.value) return 0
  const elapsed = (Date.now() - startTime.value) / 1000 / 60
  return Math.round(correctChars.value / 5 / elapsed) || 0
})

const accuracy = computed(() => {
  if (totalChars.value === 0) return 100
  return Math.round((correctChars.value / totalChars.value) * 100)
})

const finalScore = computed(() => Math.round(score.value))
const finalWpm = computed(() => wpm.value)
const finalAccuracy = computed(() => accuracy.value)

// ÏàúÏúÑÌëú Ïã§ÏãúÍ∞Ñ ÏóÖÎç∞Ïù¥Ìä∏
const startLeaderboardUpdates = () => {
  loadLeaderboard()
  leaderboardTimer.value = setInterval(() => {
    loadLeaderboard()
  }, 10000) // 10Ï¥àÎßàÎã§ ÏóÖÎç∞Ïù¥Ìä∏
}

const stopLeaderboardUpdates = () => {
  if (leaderboardTimer.value) {
    clearInterval(leaderboardTimer.value)
    leaderboardTimer.value = null
  }
}

// ÏàúÏúÑÌëú Î°úÎìú
const loadLeaderboard = async () => {
  if (loadingLeaderboard.value) return
  
  loadingLeaderboard.value = true
  try {
    const data = await apiService.getLeaderboard(50, leaderboardFilter.value, leaderboardPeriod.value)
    leaderboardData.value = data
    
    // Í∞úÏù∏ ÌÜµÍ≥Ñ Î°úÎìú
    if (playerName.value) {
      await loadPersonalStats()
    }
    
    // Ï†ÑÏ≤¥ ÌÜµÍ≥Ñ Î°úÎìú
    await loadGlobalStats()
  } catch (error) {
    console.error('Failed to load leaderboard:', error)
  } finally {
    loadingLeaderboard.value = false
  }
}

// Í∞úÏù∏ ÌÜµÍ≥Ñ Î°úÎìú
const loadPersonalStats = async () => {
  try {
    const stats = await apiService.getPlayerStats(playerName.value)
    personalStats.value = stats
  } catch (error) {
    console.error('Failed to load personal stats:', error)
  }
}

// Ï†ÑÏ≤¥ ÌÜµÍ≥Ñ Î°úÎìú
const loadGlobalStats = async () => {
  try {
    const stats = await apiService.getGlobalStats()
    globalStats.value = stats
  } catch (error) {
    console.error('Failed to load global stats:', error)
  }
}

// ÏàúÏúÑ ÏÉâÏÉÅ
const getRankColor = (index) => {
  if (index === 0) return '#ffd700' // Í∏à
  if (index === 1) return '#c0c0c0' // ÏùÄ
  if (index === 2) return '#cd7f32' // Îèô
  return '#1890ff'
}

// ÎÇúÏù¥ÎèÑ ÏÉâÏÉÅ
const getDifficultyColor = (diff) => {
  return { easy: 'green', normal: 'blue', hard: 'red' }[diff] || 'default'
}

// ÎÇúÏù¥ÎèÑ ÌÖçÏä§Ìä∏
const getDifficultyText = (diff) => {
  return { easy: 'Ïâ¨ÏõÄ', normal: 'Î≥¥ÌÜµ', hard: 'Ïñ¥Î†§ÏõÄ' }[diff] || diff
}

// Í≤åÏûÑ ÏãúÏûë
const startGame = () => {
  if (!playerName.value.trim()) {
    message.error('ÌîåÎ†àÏù¥Ïñ¥ Ïù¥Î¶ÑÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî')
    return
  }
  
  gameStarted.value = true
  gameEnded.value = false
  startTime.value = Date.now()
  timeLeft.value = difficulty.value === 'easy' ? 90 : difficulty.value === 'normal' ? 60 : 45
  
  // Í≤åÏûÑ ÌÉÄÏù¥Î®∏ ÏãúÏûë
  gameTimer.value = setInterval(() => {
    timeLeft.value--
    if (timeLeft.value <= 0) {
      endGame()
    }
  }, 1000)
  
  // ÏàúÏúÑÌëú ÏóÖÎç∞Ïù¥Ìä∏ ÏãúÏûë
  startLeaderboardUpdates()
  
  // ÏûÖÎ†• ÌïÑÎìúÏóê Ìè¨Ïª§Ïä§
  nextTick(() => {
    gameInput.value?.focus()
  })
}

// ÏûÖÎ†• Ï≤òÎ¶¨
const handleInput = (e) => {
  const input = e.target.value
  totalChars.value++
  
  // Ï†ïÌôïÎèÑ Í≥ÑÏÇ∞
  if (input === currentText.value.substring(0, input.length)) {
    correctChars.value++
  } else {
    errors.value++
  }
  
  // Î¨∏Ïû• ÏôÑÎ£å Ï≤¥ÌÅ¨
  if (input === currentText.value) {
    completeSentence()
  }
}

// ÌÇ§ ÏûÖÎ†• Ï≤òÎ¶¨
const handleKeyDown = (e) => {
  // ÌäπÏàò Ïù¥Î≤§Ìä∏ Ï≤¥ÌÅ¨
  checkSpecialEvents(userInput.value + e.key)
}

// Î¨∏Ïû• ÏôÑÎ£å
const completeSentence = () => {
  completedSentences.value++
  
  // Ï†êÏàò Í≥ÑÏÇ∞
  const timeBonus = Math.max(0, timeLeft.value)
  const accuracyBonus = accuracy.value
  score.value += (100 + timeBonus + accuracyBonus) * getDifficultyMultiplier()
  
  // Îã§Ïùå Î¨∏Ïû•ÏúºÎ°ú
  currentTextIndex.value++
  userInput.value = ''
  
  // Î™®Îì† Î¨∏Ïû• ÏôÑÎ£åÏãú
  if (currentTextIndex.value >= gameTexts[difficulty.value].length) {
    endGame()
  }
  
  message.success(`Î¨∏Ïû• ÏôÑÎ£å! +${100 + timeBonus + accuracyBonus} Ï†ê`)
}

// ÌäπÏàò Ïù¥Î≤§Ìä∏ Ï≤¥ÌÅ¨
const checkSpecialEvents = (text) => {
  for (const event of specialEvents) {
    if (text.includes(event.trigger) && !eventTriggered.value.has(event.id)) {
      triggerEvent(event)
      eventTriggered.value.add(event.id)
      break
    }
  }
}

// Ïù¥Î≤§Ìä∏ Ïã§Ìñâ
const triggerEvent = (event) => {
  currentEvent.value = {
    message: event.name,
    type: event.type,
    description: event.description
  }
  
  // Ïù¥Î≤§Ìä∏ Ìö®Í≥º Ï†ÅÏö©
  if (event.effect.type === 'score') {
    score.value += event.effect.value
  } else if (event.effect.type === 'time') {
    timeLeft.value = Math.max(0, timeLeft.value + event.effect.value)
  } else if (event.effect.type === 'chaos') {
    // ÌòºÎèà Ïù¥Î≤§Ìä∏: ÏûÖÎ†• ÌïÑÎìú ÏùºÏãúÏ†ÅÏúºÎ°ú ÎπÑÌôúÏÑ±Ìôî
    gameInput.value.disabled = true
    setTimeout(() => {
      gameInput.value.disabled = false
      gameInput.value.focus()
    }, 2000)
  }
  
  // 3Ï¥à ÌõÑ Ïù¥Î≤§Ìä∏ ÏïåÎ¶º ÏûêÎèô Îã´Í∏∞
  setTimeout(() => {
    currentEvent.value = null
  }, 3000)
}

// Î¨∏Ïûê Ïä§ÌÉÄÏùº ÌÅ¥ÎûòÏä§
const getCharClass = (index) => {
  if (index < userInput.value.length) {
    return userInput.value[index] === currentText.value[index] 
      ? 'correct' : 'incorrect'
  } else if (index === userInput.value.length) {
    return 'current'
  }
  return 'pending'
}

// ÎÇúÏù¥ÎèÑ Î∞∞Ïàò
const getDifficultyMultiplier = () => {
  return { easy: 1, normal: 1.5, hard: 2 }[difficulty.value]
}

// Í≤åÏûÑ Ï¢ÖÎ£å
const endGame = () => {
  gameEnded.value = true
  clearInterval(gameTimer.value)
  showResults.value = true
}

// Í∏∞Î°ù Ï†ÄÏû•
const saveRecord = async () => {
  saving.value = true
  try {
    const record = {
      playerName: playerName.value,
      score: finalScore.value,
      wpm: finalWpm.value,
      accuracy: finalAccuracy.value,
      difficulty: difficulty.value,
      completedSentences: completedSentences.value,
      playTime: 60 - timeLeft.value
    }
    
    await apiService.saveGameRecord(record)
    message.success('Í∏∞Î°ùÏù¥ Ï†ÄÏû•ÎêòÏóàÏäµÎãàÎã§!')
    showResults.value = false
    
    // ÏàúÏúÑÌëú Ï¶âÏãú ÏóÖÎç∞Ïù¥Ìä∏
    loadLeaderboard()
  } catch (error) {
    message.error('Í∏∞Î°ù Ï†ÄÏû•Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§: ' + error.message)
  } finally {
    saving.value = false
  }
}

// Í≤åÏûÑ Î¶¨ÏÖã
const resetGame = () => {
  gameStarted.value = false
  gameEnded.value = false
  showResults.value = false
  currentTextIndex.value = 0
  userInput.value = ''
  score.value = 0
  completedSentences.value = 0
  totalChars.value = 0
  correctChars.value = 0
  errors.value = 0
  currentEvent.value = null
  eventTriggered.value.clear()
  clearInterval(gameTimer.value)
  stopLeaderboardUpdates()
}

// ÌîåÎ†àÏù¥Ïñ¥ Ïù¥Î¶Ñ Î≥ÄÍ≤ΩÏãú Í∞úÏù∏ ÌÜµÍ≥Ñ ÏóÖÎç∞Ïù¥Ìä∏
watch(playerName, (newName) => {
  if (newName) {
    loadPersonalStats()
  }
})

// Ïª¥Ìè¨ÎÑåÌä∏ ÎßàÏö¥Ìä∏Ïãú ÏàúÏúÑÌëú Î°úÎìú
onMounted(() => {
  startLeaderboardUpdates()
})

// Ïª¥Ìè¨ÎÑåÌä∏ Ïñ∏ÎßàÏö¥Ìä∏Ïãú Ï†ïÎ¶¨
onUnmounted(() => {
  if (gameTimer.value) {
    clearInterval(gameTimer.value)
  }
  stopLeaderboardUpdates()
})
</script>

<style scoped>
.typing-game {
  min-height: 100vh;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
}

.game-header {
  background: rgba(255, 255, 255, 0.95);
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 0 24px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}

.game-header h1 {
  color: #1890ff;
  margin: 0;
  font-weight: bold;
}

.stats {
  display: flex;
  gap: 32px;
}

.main-layout {
  min-height: calc(100vh - 64px);
}

.game-content {
  padding: 24px;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
}

.setup-panel {
  max-width: 400px;
  margin: 0 auto;
  background: rgba(255, 255, 255, 0.95);
}

.game-area {
  max-width: 800px;
  margin: 0 auto;
}

.game-info {
  background: rgba(255, 255, 255, 0.95);
  padding: 16px;
  border-radius: 8px;
  margin-bottom: 16px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.text-display {
  background: rgba(255, 255, 255, 0.95);
  margin-bottom: 16px;
}

.target-text {
  font-family: 'Courier New', monospace;
  font-size: 20px;
  line-height: 1.8;
  padding: 16px;
  background: #f5f5f5;
  border-radius: 4px;
  min-height: 100px;
}

.target-text span.correct {
  background-color: #52c41a;
  color: white;
}

.target-text span.incorrect {
  background-color: #ff4d4f;
  color: white;
}

.target-text span.current {
  background-color: #1890ff;
  color: white;
  animation: blink 1s infinite;
}

.target-text span.pending {
  color: #666;
}

@keyframes blink {
  0%, 50% { opacity: 1; }
  51%, 100% { opacity: 0.3; }
}

.input-area {
  background: rgba(255, 255, 255, 0.95);
  padding: 16px;
  border-radius: 8px;
}

.event-alert {
  margin-top: 16px;
  animation: slideIn 0.3s ease-out;
}

@keyframes slideIn {
  from {
    transform: translateY(-20px);
    opacity: 0;
  }
  to {
    transform: translateY(0);
    opacity: 1;
  }
}

.results {
  text-align: center;
}

.result-actions {
  margin-top: 24px;
  display: flex;
  gap: 12px;
  justify-content: center;
}

.timer {
  text-align: center;
}

/* ÏàúÏúÑÌëú Ïä§ÌÉÄÏùº */
.leaderboard-sidebar {
  background: rgba(255, 255, 255, 0.98) !important;
  border-left: 1px solid #f0f0f0;
  box-shadow: -2px 0 8px rgba(0, 0, 0, 0.1);
}

.leaderboard-container {
  height: 100%;
  padding: 16px;
  overflow-y: auto;
}

.leaderboard-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 16px;
}

.leaderboard-header h3 {
  margin: 0;
  color: #1890ff;
  font-size: 16px;
}

.leaderboard-filters {
  margin-bottom: 16px;
  display: flex;
  align-items: center;
}

.leaderboard-list {
  flex: 1;
  margin-bottom: 16px;
}

.leaderboard-item {
  padding: 8px 0 !important;
  border-bottom: 1px solid #f0f0f0;
  transition: all 0.3s ease;
}

.leaderboard-item:hover {
  background-color: #f5f5f5;
  transform: translateX(2px);
}

.leaderboard-item.current-player {
  background-color: #e6f7ff;
  border-left: 3px solid #1890ff;
  padding-left: 12px;
}

.leaderboard-item.top-three {
  background: linear-gradient(45deg, #fff7e6, #fff2e8);
}

.rank-info {
  display: flex;
  align-items: center;
  width: 100%;
}

.rank-number {
  margin-right: 12px;
  min-width: 32px;
}

.player-info {
  flex: 1;
  min-width: 0;
}

.player-name {
  font-weight: 500;
  font-size: 14px;
  color: #333;
  display: flex;
  align-items: center;
  gap: 4px;
  margin-bottom: 2px;
}

.player-stats {
  display: flex;
  gap: 8px;
  font-size: 12px;
  color: #666;
  margin-bottom: 2px;
}

.score {
  color: #52c41a;
  font-weight: 500;
}

.wpm {
  color: #1890ff;
}

.accuracy {
  color: #fa8c16;
}

.play-time {
  font-size: 11px;
  color: #999;
}

.personal-stats,
.global-stats {
  background: #f9f9f9;
  padding: 12px;
  border-radius: 6px;
  margin-bottom: 12px;
}

.personal-stats .ant-statistic {
  margin-bottom: 8px;
}

/* Î∞òÏùëÌòï ÎîîÏûêÏù∏ */
@media (max-width: 1200px) {
  .leaderboard-sidebar {
    width: 350px !important;
  }
}

@media (max-width: 992px) {
  .main-layout {
    flex-direction: column;
  }
  
  .leaderboard-sidebar {
    width: 100% !important;
    height: auto;
    order: 2;
  }
  
  .game-content {
    order: 1;
  }
  
  .leaderboard-container {
    height: auto;
    max-height: 400px;
  }
}
</style>
